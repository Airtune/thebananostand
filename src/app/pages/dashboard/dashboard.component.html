<ng-template #accountNumber let-account="account">
    <blui-list-item-tag
        class="account-number-tag"
        [label]="(account.index > 100000 ? '#' : 'Account #') + _util.numberWithCommas(account.index)"
    ></blui-list-item-tag>
</ng-template>

<ng-template #accountActionsUserMenu>
    <blui-user-menu menuTitle="Wallet Actions" [(open)]="mobileUserMenuOpen" *ngIf="vp.sm">
        <mat-icon data-cy="show-dashboard-actions" blui-avatar>more_vert</mat-icon>
        <mat-nav-list blui-menu-body [style.paddingTop.px]="0">
            <blui-info-list-item
                [dense]="true"
                (click)="addAccount(); mobileUserMenuOpen = false"
                data-cy="add-next-account-mobile-button"
            >
                <mat-icon blui-icon>add</mat-icon>
                <div blui-title>Add Account</div>
            </blui-info-list-item>
            <blui-info-list-item
                [dense]="true"
                (click)="addAccountFromIndex(); mobileUserMenuOpen = false"
                data-cy="add-specific-account-mobile-button"
            >
                <mat-icon blui-icon>manage_search</mat-icon>
                <div blui-title>Add Specific Account</div>
            </blui-info-list-item>
            <blui-info-list-item
                [dense]="true"
                (click)="refresh(); mobileUserMenuOpen = false"
                data-cy="refresh-dashboard-mobile-button"
            >
                <mat-icon blui-icon>refresh</mat-icon>
                <div blui-title>Refresh Balances</div>
            </blui-info-list-item>
            <blui-info-list-item [dense]="true" (click)="isAdvancedView = !isAdvancedView; mobileUserMenuOpen = false"
                data-cy="select-accounts-mobile-button">
                <mat-icon blui-icon>visibility</mat-icon>
                <div blui-title>
                    <ng-container *ngIf="!isAdvancedView">Enable Select Accounts</ng-container>
                    <ng-container *ngIf="isAdvancedView">Disable Select Accounts</ng-container>
                </div>
            </blui-info-list-item>
            <blui-info-list-item
                *ngIf="selectedItems.size > 0"
                [dense]="true"
                (click)="hideSelected(); mobileUserMenuOpen = false"
                data-cy="remove-account-mobile-button"
            >
                <mat-icon blui-icon>delete</mat-icon>
                <div blui-title>Hide Selected Accounts</div>
            </blui-info-list-item>
        </mat-nav-list>
    </blui-user-menu>
</ng-template>

<div
    *ngIf="!vp.sm"
    style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        height: 40px;
        margin-top: 24px;
    "
>
    <div style="padding-left: 4px">
        <button
            mat-mini-fab
            data-cy="add-single-account-desktop-button"
            color="primary"
            (click)="addAccount()"
            [disabled]="loadingAccount"
            matTooltip="Add next account"
            matTooltipPosition="above"
        >
            <mat-icon>add</mat-icon>
        </button>
        <button
            *ngIf="isAdvancedView"
            mat-mini-fab
            data-cy="add-specific-account-desktop-button"
            color="primary"
            style="margin-left: 16px"
            (click)="addAccountFromIndex()"
            [disabled]="loadingAccount"
            matTooltip="Add a specific account"
            matTooltipPosition="above"
        >
            <mat-icon>manage_search</mat-icon>
        </button>
        <button
            *ngIf="isAdvancedView"
            mat-mini-fab
            data-cy="refresh-dashboard-desktop-button"
            color="primary"
            style="margin-left: 16px"
            (click)="refresh()"
            [disabled]="loadingAllAccounts"
            matTooltip="Refresh all displayed accounts"
            matTooltipPosition="above"
        >
            <mat-icon>refresh</mat-icon>
        </button>
        <button
            *ngIf="isAdvancedView"
            mat-mini-fab
            color="warn"
            data-cy="remove-account-dashboard-desktop-button"
            style="margin-left: 16px"
            (click)="hideSelected()"
            [disabled]="selectedItems.size === 0"
            matTooltip="Hide selected accounts from view"
            matTooltipPosition="above"
        >
            <mat-icon>delete</mat-icon>
        </button>
    </div>

    <mat-slide-toggle
        data-cy="advanced-toggle"
        color="primary"
        [(ngModel)]="isAdvancedView"
        (change)="exitEdit($event)"
    >
        Advanced
    </mat-slide-toggle>
</div>

<mat-card style="padding: 0; display: flex; flex-direction: column">
    <div style="margin-left: 16px; padding: 16px 0; display: flex; justify-content: space-between; align-items: center">
        <div>
            <mat-checkbox
                color="warn"
                *ngIf="isAdvancedView"
                [disabled]="getAccounts().length === 0"
                style="margin-right: 24px"
                (change)="toggleAll($event)"
                [indeterminate]="selectedItems.size < getAccounts().length && selectedItems.size > 0"
                [checked]="selectedItems.size === getAccounts().length && selectedItems.size > 0"
            >
            </mat-checkbox>
            <span class="mat-subheading-1" style="margin-right: 8px; margin-left: 8px"> Accounts Balance: </span>
            <span> {{ getBalance() }}</span>
        </div>
        <ng-template [ngTemplateOutlet]="accountActionsUserMenu"></ng-template>
    </div>
    <mat-divider style="position: relative" *ngIf="getAccounts().length > 0"></mat-divider>

    <blui-empty-state
        *ngIf="getAccounts().length === 0 && !loadingAllAccounts"
        style="margin: 64px 0 48px 0"
        title="No Accounts Displayed"
        description="Use the buttons above to add an account."
    >
        <mat-icon blui-empty-icon>search</mat-icon>
    </blui-empty-state>

    <mat-nav-list
        responsive
        data-cy="dashboard-account-list"
        class="dashboard-account-list"
        style="
            overflow: auto;
            padding-top: 0;
            border-top-right-radius: 0 !important;
            border-top-left-radius: 0 !important;
        "
        [style.maxHeight]="vp.sm ? 'calc(100vh - (56px + 74px))' : 'calc(100vh - 300px)'"
        *ngIf="getAccounts().length > 0"
        [class.fade]="fade"
        [disableRipple]="disableRipple"
    >
        <blui-info-list-item
            *ngFor="let account of getAccounts(); let i = index; let even = even"
            [divider]="i === getAccounts().length - 1 ? undefined : 'partial'"
            [hidePadding]="true"
            (click)="openAccount(account.fullAddress)"
            [style.backgroundColor]="
                even
                    ? isDark()
                        ? colors.darkBlack[300]
                        : colors.white[100]
                    : isDark()
                    ? colors.darkBlack[200]
                    : colors.white[50]
            "
        >
            <mat-checkbox
                *ngIf="isAdvancedView"
                blui-icon
                color="warn"
                style="margin-bottom: 6px"
                (click)="$event.stopPropagation()"
                (mouseenter)="disableRipple = true"
                (mouseleave)="disableRipple = false"
                [checked]="selectedItems.has(account.index)"
                (change)="toggleCheck($event, account)"
            >
            </mat-checkbox>
            <div blui-left-content [style.minWidth.px]="vp.sm ? 50 : 120" *ngIf="!vp.sm">
                <ng-template *ngTemplateOutlet="accountNumber; context: { account: this.account }"></ng-template>
            </div>
            <div blui-title style="font-family: monospace">{{ account.shortAddress }}</div>
            <div blui-subtitle *ngIf="!vp.sm">
                <ng-container *ngIf="account.representative">
                    represented by {{ formatRepresentative(account.representative) }}
                </ng-container>
                <ng-container *ngIf="!account.representative"> unopened account </ng-container>
            </div>
            <div blui-info *ngIf="vp.sm" style="margin-top: 4px">
                <ng-template *ngTemplateOutlet="accountNumber; context: { account: this.account }"></ng-template>
            </div>
            <div blui-right-content>
                <blui-list-item-tag
                    *ngIf="account.pending.length > 0"
                    label="Has Receivable"
                    class="receivable-tag"
                    style="margin-right: 16px"
                    [backgroundColor]="colors.orange[500]"
                >
                </blui-list-item-tag>
                <blui-list-item-tag
                    *ngIf="showRepresentativeOffline(account.representative)"
                    label="Rep Offline"
                    class="rep-offline-tag"
                    [backgroundColor]="colors.red[500]"
                    style="margin-right: 16px"
                ></blui-list-item-tag>

                <blui-list-item-tag
                    *ngIf="!account.representative"
                    [label]="vp.sm ? 'Unopened' : 'Unopened Account'"
                    class="unopened-account-tag"
                    [fontColor]="colors.black[500]"
                    [backgroundColor]="colors.gray[100]"
                >
                </blui-list-item-tag>

                <ng-container *ngIf="account.representative">
                    {{ account.formattedBalance }}
                </ng-container>
            </div>
        </blui-info-list-item>
    </mat-nav-list>
</mat-card>

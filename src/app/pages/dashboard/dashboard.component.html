<ng-template #accountNumber let-account="account">
    <blui-list-item-tag
        class="account-number-tag"
        [label]="(account.index > 100000 ? '#' : 'Account #') + _util.numberWithCommas(account.index)"
    ></blui-list-item-tag>
</ng-template>

<ng-template #statusBadges let-account="account">
    <blui-list-item-tag
        *ngIf="account.pending.length > 0"
        [label]="vp.sm ? 'Receivable' : 'Has Receivable'"
        class="receivable-tag"
        style="margin-right: 16px"
        [backgroundColor]="colors.orange[500]"
    >
    </blui-list-item-tag>
    <blui-list-item-tag
        *ngIf="showRepresentativeOffline(account.representative)"
        label="Rep Offline"
        class="rep-offline-tag"
        [backgroundColor]="colors.red[500]"
        style="margin-right: 16px"
    ></blui-list-item-tag>
</ng-template>

<ng-template #currentWalletActions>
    <blui-user-menu menuTitle="Account Actions" [(open)]="walletActionsUserMenuOpen">
        <mat-icon data-cy="show-dashboard-actions" blui-avatar>more_vert</mat-icon>
        <mat-nav-list blui-menu-body [style.paddingTop.px]="0">
            <blui-info-list-item
                [dense]="true"
                (click)="addAccount(); walletActionsUserMenuOpen = false"
                data-cy="add-next-account-mobile-button"
            >
                <mat-icon blui-icon>add</mat-icon>
                <div blui-title>Add Account</div>
            </blui-info-list-item>
            <blui-info-list-item
                [dense]="true"
                (click)="addAccountFromIndex(); walletActionsUserMenuOpen = false"
                data-cy="add-specific-account-mobile-button"
            >
                <mat-icon blui-icon>manage_search</mat-icon>
                <div blui-title>Add Specific Account</div>
            </blui-info-list-item>
            <blui-info-list-item
                [dense]="true"
                (click)="refresh(); walletActionsUserMenuOpen = false"
                data-cy="refresh-dashboard-mobile-button"
            >
                <mat-icon blui-icon>refresh</mat-icon>
                <div blui-title>Refresh Balances</div>
            </blui-info-list-item>
            <blui-info-list-item
                [dense]="true"
                (click)="isAdvancedView = !isAdvancedView; walletActionsUserMenuOpen = false"
                data-cy="select-accounts-mobile-button"
            >
                <mat-icon blui-icon>visibility</mat-icon>
                <div blui-title>
                    <ng-container *ngIf="!isAdvancedView">Enable Select Accounts</ng-container>
                    <ng-container *ngIf="isAdvancedView">Disable Select Accounts</ng-container>
                </div>
            </blui-info-list-item>
            <blui-info-list-item
                *ngIf="selectedItems.size > 0"
                [dense]="true"
                (click)="hideSelected(); walletActionsUserMenuOpen = false"
                data-cy="remove-account-mobile-button"
            >
                <mat-icon blui-icon>delete</mat-icon>
                <div blui-title>Hide Selected Accounts</div>
            </blui-info-list-item>
        </mat-nav-list>
    </blui-user-menu>
</ng-template>

<ng-template #switchWalletActions>
    <blui-user-menu [(open)]="switchWalletUserMenuOpen" class="switch-wallet-user-menu" menuTitle="Switch Wallet">
        <mat-icon data-cy="show-dashboard-actions" blui-avatar matTooltip="Switch Wallet">arrow_drop_down</mat-icon>
        <mat-nav-list blui-menu-body [style.paddingTop.px]="0">
            <div style="max-height: 180px; overflow: auto">
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 2</div>
                </blui-info-list-item>
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 3</div>
                </blui-info-list-item>
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 3</div>
                </blui-info-list-item>
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 3</div>
                </blui-info-list-item>
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 3</div>
                </blui-info-list-item>
                <blui-info-list-item [dense]="true" [hidePadding]="true" (click)="switchWalletUserMenuOpen = false">
                    <div blui-title>Unnamed Wallet 3</div>
                </blui-info-list-item>
            </div>
        </mat-nav-list>
    </blui-user-menu>
</ng-template>

<ng-template #manageWallet>
    <blui-user-menu [(open)]="manageWalletUserMenuOpen" class="switch-wallet-user-menu" menuTitle="Edit Wallets">
        <mat-icon data-cy="show-dashboard-actions" blui-avatar style="margin-left: 8px" matTooltip="Manage Accounts">
            edit_note
        </mat-icon>
        <mat-nav-list blui-menu-body [style.paddingTop.px]="0">
            <blui-info-list-item [dense]="true" (click)="openEnterSeedDialog(); switchWalletUserMenuOpen = false">
                <mat-icon blui-icon>add_circle</mat-icon>
                <div blui-title>Add Wallet</div>
            </blui-info-list-item>
            <blui-info-list-item [dense]="true" (click)="openEnterSeedDialog(); switchWalletUserMenuOpen = false">
                <mat-icon blui-icon>edit</mat-icon>
                <div blui-title>Rename Wallet</div>
            </blui-info-list-item>
            <blui-info-list-item [dense]="true" (click)="openEnterSeedDialog(); switchWalletUserMenuOpen = false">
                <mat-icon blui-icon>delete</mat-icon>
                <div blui-title>Remove Wallet</div>
            </blui-info-list-item>
        </mat-nav-list>
    </blui-user-menu>
</ng-template>

<mat-card
    style="padding: 0; display: flex; flex-direction: column; overflow: hidden"
    [style.marginTop.px]="vp.sm ? 0 : 16"
>
    <div
        style="padding: 16px 24px 16px 24px; display: flex; justify-content: space-between; align-items: center"
        class="dashboard-header"
    >
        <div style="width: 100%; display: flex; align-items: center">
            <mat-checkbox
                color="warn"
                *ngIf="isAdvancedView"
                [disabled]="getAccounts().length === 0"
                style="margin-right: 32px"
                (change)="toggleAll($event)"
                [indeterminate]="selectedItems.size < getAccounts().length && selectedItems.size > 0"
                [checked]="selectedItems.size === getAccounts().length && selectedItems.size > 0"
            >
            </mat-checkbox>
            <div>
                <!--
                <div style="display: flex; align-items: center; margin-bottom: 4px; width: 100%">

                    <div class="blui-headline-6 primary" style="margin: 0 8px 0 0">Unnamed Wallet 1</div>
                    <ng-template [ngTemplateOutlet]="switchWalletActions" style="margin-right: 4px"></ng-template>
                    <ng-template [ngTemplateOutlet]="manageWallet"></ng-template>
                </div> -->
                <div>
                    <span class="mat-subheading-1" style="margin-right: 8px"> Accounts Balance: </span>
                    <span> {{ getBalance() }}</span>
                    <ng-container *ngIf="!vp.sm"> BAN</ng-container>
                </div>
            </div>
        </div>
        <ng-template [ngTemplateOutlet]="currentWalletActions"></ng-template>
    </div>
    <mat-divider style="position: relative" *ngIf="getAccounts().length > 0"></mat-divider>

    <blui-empty-state
        *ngIf="getAccounts().length === 0 && !loadingAllAccounts"
        style="margin: 64px 0 48px 0"
        title="No Accounts Displayed"
        description="Use the buttons above to add an account."
    >
        <mat-icon blui-empty-icon>search</mat-icon>
    </blui-empty-state>

    <mat-nav-list
        responsive
        data-cy="dashboard-account-list"
        class="dashboard-account-list"
        style="
            overflow: auto;
            padding-top: 0;
            border-top-right-radius: 0 !important;
            border-top-left-radius: 0 !important;
        "
        *ngIf="getAccounts().length > 0"
        [class.fade]="fade"
        [disableRipple]="disableRipple"
    >
        <blui-info-list-item
            *ngFor="let account of getAccounts(); let i = index; let even = even"
            (mouseenter)="hoverRowNumber = i"
            (mouseleave)="hoverRowNumber = undefined"
            [class.hovered]="hoverRowNumber === i"
            [divider]="i === getAccounts().length - 1 ? undefined : 'partial'"
            [hidePadding]="true"
            (click)="openAccount(account.fullAddress)"
            [style.backgroundColor]="
                even
                    ? isDark()
                        ? colors.darkBlack[300]
                        : colors.white[100]
                    : isDark()
                    ? colors.darkBlack[200]
                    : colors.white[50]
            "
        >
            <div blui-left-content style="display: flex; align-items: center">
                <mat-checkbox
                    *ngIf="isAdvancedView"
                    color="warn"
                    style="margin-bottom: 6px; margin-right: 16px"
                    (click)="$event.stopPropagation()"
                    (mouseenter)="disableRipple = true"
                    (mouseleave)="disableRipple = false"
                    [checked]="selectedItems.has(account.index)"
                    (change)="toggleCheck($event, account)"
                >
                </mat-checkbox>
                <img [src]="getMonkeyUrl(account.fullAddress)" loading="lazy" [height]="vp.sm ? 64 : 72" />
                <div class="account-number mat-hint">#{{ _util.numberWithCommas(account.index) }}</div>
                <!--<div [style.minWidth.px]="vp.sm ? 50 : 120"  *ngIf="!vp.sm">
                    <ng-template *ngTemplateOutlet="accountNumber; context: { account: this.account }"></ng-template>
                </div> -->
            </div>
            <div
                blui-title
                class="mono"
                style="padding: 1px 0; z-index: 2"
                [style.fontSize.px]="vp.sm ? 15 : 'inherit'"
            >
                {{ account.shortAddress }}
            </div>
            <div blui-subtitle *ngIf="!vp.sm" style="padding: 1px 0">
                <ng-container *ngIf="account.representative">
                    represented by {{ formatRepresentative(account.representative) }}
                </ng-container>
                <!--
                <ng-container *ngIf="!account.representative"> unopened account </ng-container>
                -->
            </div>
            <div blui-info *ngIf="vp.sm" style="margin-top: 4px">
                <div style="display: flex">
                    <!--
                    <div style="margin-right: 8px">
                        <ng-template
                            *ngTemplateOutlet="accountNumber; context: { account: this.account }"
                        ></ng-template>
                    </div>
                    -->
                    <div>
                        <ng-template *ngTemplateOutlet="statusBadges; context: { account: this.account }"></ng-template>
                    </div>
                </div>
            </div>
            <div blui-right-content>
                <ng-container *ngIf="!vp.sm">
                    <ng-template *ngTemplateOutlet="statusBadges; context: { account: this.account }"></ng-template>
                </ng-container>

                <blui-list-item-tag
                    *ngIf="!account.representative"
                    [label]="vp.sm ? 'Unopened' : 'Unopened Account'"
                    class="unopened-account-tag"
                    [fontColor]="colors.black[500]"
                    [backgroundColor]="colors.gray[100]"
                >
                </blui-list-item-tag>

                <ng-container *ngIf="account.representative">
                    <img
                        *ngIf="!vp.sm"
                        style="margin-left: 16px; margin-right: 6px"
                        src="assets/banano-mark.svg"
                        [width]="18"
                        [height]="18"
                    />
                    <span>
                        {{ account.formattedBalance }}
                    </span>
                </ng-container>
            </div>
        </blui-info-list-item>
    </mat-nav-list>
</mat-card>
